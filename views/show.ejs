<%include partials/header%>
<div class='ui main text container segment show'>
    <div class='ui huge header'><%=blog.title%></div>
    <hr>
    </hr>
    <div class='ui top attached '>
        <div class='item'>
            <div class="my-img">
                <img class='ui centered rounded image' src="<%=blog.image%>">
            </div>
            <div class='content'>
                <br>
                <br>
                <div class='description white-space-pre-wrap'>
                    <p><%= blog.body%></p>
                </div>
            </div>
            <% if(currentUser&&blog.author.id.equals(currentUser._id)){%>
            <div class="hidden-btn">
                <a href='/blogs/<%=blog._id%>/edit' class='ui blue basic button'>EDIT</a>
                <form id='delete' action='/blogs/<%=blog._id%>?_method=DELETE' method='POST'>
                    <button class='ui blue basic button'>DELETE</button>
                </form>
            </div>
            <%}%>
                    <br>
                    <div class='meta showmeta '>
                        <span><strong>Created By: <%=blog.author.username%> </strong></span>
            <br>
            <span><%=moment(blog.created).fromNow()%></span>
        </div>
    </div>
    <div class="commentBox">
        <div class="comment-wrapper">
            <div class="comments-list" id="comments-list">
                <% blog.comments.forEach(function(comment){%>
                <div class="comment-info">
                    <div class="name"><%=comment.author.username%></div>
                    <div class="text"><%=comment.text %></div>    
                    <div>
                    <button id="edit" type="button" onclick="editButtonOnClick(this)">Edit</button>
                    <button id="cancel" style="display:none;" type="button">Cancel</button>
                    <button style="display: none;" id="update" onclick="updateButtonOnClick(this,'/blogs/<%=blog._id%>/comment/<%=comment._id%>?_method=PUT')">Update</button>
                    <form id='delete' action='/blogs/<%=blog._id%>/comment/<%=comment._id%>?_method=DELETE' method='POST'>
                        <span><button>Delete</button></span>
                    </form>
                    </div>
                        <span class='meta showmeta '><%=moment(comment.createdAt).fromNow()%></span>
                             
                </div>
                <% }) %>
                <script id="comment-template" type="text/x-template">
                        <div class="comment-info">
                              <div class="name">{{name}}</div>
                               <div class="text">{{comment}}</div>
                               <div>
                               <button id="edit" type="button" onclick="editButtonOnClick(this)">Edit</button>
                               <button style="display:none;" id="cancel" type="button">Cancel</button>
                               <button  style="display:none;" id="update" onclick="updateButtonOnClick(this,'{{updateurl}}')">Update</button>
                               <form id='delete' action='{{url}}' method='POST'>
                                <span><button>Delete</button></span>
                            </form> 
                             </div>
                                <span class='meta showmeta'>{{created}}</span>
                        </div>
                 </script>
            </div>
        </div>
    </div>
    <div>
    <section>
        Add your comments...
        <form id="addComment">
            <textarea id="comment-box" style="width: 100%;" name="text" row="10" col="500"></textarea>
            <button type="submit" class='ui blue basic button'>Add Comment</button>
        </form>
    </section>
</div>
</div>
</div>
<div id="mydiv" data-test=<%= blog._id %>></div>
<div id="user" data-user=<%= currentUser.username%>></div>

<script src="/script/blog.js"></script>
<%include partials/footer%>